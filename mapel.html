<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pilih Mata Pelajaran</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body>
  <div class="container mt-5">
    <h4>Pilih Mata Pelajaran</h4>
    <div id="mapel-list" class="row g-3 mt-3"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const user = JSON.parse(sessionStorage.getItem('user'));
    if (!user) window.location.href = 'index.html';

    function getMapel(kelas) {
      return new Promise(resolve => {
        const cb = 'cb_' + Date.now();
        window[cb] = res => { resolve(res.mapel); delete window[cb]; };
        const base = 'https://script.google.com/macros/s/AKfycbweUxww34uk0pqPE-Gk_xaebgvxRNRCFicXy7I22gYTlt2xFi1uwrv1iK0FhTDEaw17/exec';
        const params = [
          'action=getMapel',
          'kelas=' + encodeURIComponent(kelas),
          'callback=' + cb
        ].join('&');
        const s = document.createElement('script');
        s.src = `${base}?${params}`;
        document.body.appendChild(s);
      });
    }

    document.addEventListener('DOMContentLoaded', async () => {
      const mapelList = await getMapel(user.kelas);
      const container = document.getElementById('mapel-list');
      mapelList.forEach(item => {
        const col = document.createElement('div');
        col.className = 'col-6';
        const btn = document.createElement('button');
        btn.className = 'btn w-100';
        btn.textContent = item.mataPelajaran;
        if (item.status.toLowerCase() === 'aktif') {
          btn.classList.add('btn-success');
          btn.onclick = () => {
            sessionStorage.setItem('mapel', item.mataPelajaran);
            window.location.href = 'soal.html';
          };
        } else {
          btn.classList.add('btn-secondary');
          btn.disabled = true;
        }
        col.appendChild(btn);
        container.appendChild(col);
      });
    });
  </script>
</body>
</html>